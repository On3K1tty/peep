*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html, body { width: 100%; height: 100%; overflow: hidden; font-family: system-ui, sans-serif; background: #1a1a2e; color: #eee; touch-action: none; user-select: none; -webkit-user-select: none; }

#app { width: 100vw; height: 100vh; position: relative; }
.mode-edit .play-only, .mode-play .edit-only, .mode-splash .edit-only, .mode-splash .play-only, .mode-race .edit-only, .mode-race .play-only { display: none !important; }
.mode-splash .gyro-btn { display: none !important; }

/* ── 3D World + Fake Shadows ── */
.voxel-world { background: linear-gradient(180deg, #0f3460 0%, #16213e 40%, #1a1a2e 100%); }
.voxel-world::before { content:''; position:fixed; inset:0; pointer-events:none; z-index:1; background:linear-gradient(to bottom,transparent 20%,rgba(0,0,0,0.25) 100%); mix-blend-mode:multiply; }
.voxel-world::after { content:''; position:fixed; inset:0; pointer-events:none; z-index:1; opacity:0.06; background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); mix-blend-mode:multiply; }

/* ── HUD ── */
.hud { position:fixed; inset:0; pointer-events:none; z-index:50; }
.hud > * { pointer-events:auto; }
.hud-top { position:absolute; top:8px; left:0; right:0; text-align:center; font-size:18px; font-weight:700; text-shadow:0 1px 4px rgba(0,0,0,0.7); }
.hud-score::before { content:'\2B50 '; }
.hud-msg { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.75); padding:16px 28px; border-radius:10px; font-size:20px; font-weight:700; display:none; text-align:center; }
.hud-toast { position:absolute; top:60px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); padding:6px 16px; border-radius:8px; font-size:13px; opacity:0; transition:opacity 0.3s; }
.hud-toast.show { opacity:1; }

/* ── D-Pad ── */
.hud-dpad { position:absolute; bottom:16px; left:16px; display:grid; grid-template-columns:48px 48px 48px; grid-template-rows:48px 48px; gap:4px; }
.dp { width:48px; height:48px; border:none; border-radius:8px; background:rgba(255,255,255,0.12); color:#fff; font-size:18px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
.dp:active { background:rgba(255,255,255,0.25); }
.dp-u { grid-column:2; grid-row:1; } .dp-l { grid-column:1; grid-row:2; } .dp-r { grid-column:3; grid-row:2; } .dp-d { grid-column:2; grid-row:2; }
.dp-j { grid-column:3; grid-row:1; background:rgba(76,175,80,0.25); }
.hud-crosshair { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:28px; color:rgba(255,255,255,0.6); pointer-events:none; text-shadow:0 0 4px rgba(0,0,0,0.8); display:none; font-weight:300; }
.hud-shoot { position:absolute; bottom:20px; right:20px; width:64px; height:64px; border-radius:50%; border:2px solid rgba(255,100,100,0.4); background:rgba(255,50,50,0.15); color:#ff6666; font-size:32px; display:none; align-items:center; justify-content:center; cursor:pointer; }
.hud-shoot:active { background:rgba(255,50,50,0.4); }

/* ── Toolbar (icon buttons 40px, no text) ── */
.toolbar { position:fixed; bottom:0; left:0; right:0; background:rgba(20,20,30,0.95); backdrop-filter:blur(6px); display:flex; align-items:center; gap:2px; padding:4px 4px; z-index:100; border-top:1px solid rgba(255,255,255,0.08); }
.toolbar .tb-btn {
  flex:0 0 40px; width:40px; height:40px; border:none; border-radius:8px; background:rgba(255,255,255,0.08); color:#fff;
  cursor:pointer; display:flex; align-items:center; justify-content:center; padding:0;
}
.toolbar .tb-btn:active { background:rgba(255,255,255,0.2); }
.toolbar .tb-btn.active { background:rgba(76,175,80,0.35); }
.toolbar .tb-icon { width:22px; height:22px; }
.toolbar .tb-lang { font-size:22px; line-height:1; }
.tb-spacer { flex:1 1 0; min-width:8px; }
/* ── Flag picker popup ── */
.flag-picker { position:fixed; inset:0; z-index:300; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.5); }
.flag-picker-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(44px, 1fr)); gap:6px; max-width:320px; max-height:70vh; overflow:auto; padding:12px; background:rgba(20,20,30,0.98); border-radius:12px; border:1px solid rgba(255,255,255,0.1); }
.flag-picker-btn { width:44px; height:44px; border:none; border-radius:8px; background:rgba(255,255,255,0.08); font-size:28px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
.flag-picker-btn:active { background:rgba(255,255,255,0.2); }
.flag-picker-btn.active { background:rgba(76,175,80,0.35); }

/* ── Layer grid (2D slice editor) ── */
.layer-grid { position:fixed; top:8px; left:8px; z-index:85; background:rgba(20,20,30,0.92); border-radius:10px; padding:8px; border:1px solid rgba(255,255,255,0.08); }
.layer-grid-header { display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:6px; font-size:12px; color:#aaa; }
.layer-grid-label { min-width:100px; text-align:center; }
.layer-grid-btn { width:36px; height:28px; border:none; border-radius:6px; background:rgba(255,255,255,0.1); color:#fff; font-size:11px; cursor:pointer; }
.layer-grid-btn:active { background:rgba(76,175,80,0.3); }
.layer-grid-canvas { display:block; width:250px; height:250px; border-radius:6px; background:#0f3460; cursor:crosshair; touch-action:none; }

/* ── 3D Editor (FULL SCREEN, Minecraft-style) ── */
.editor-3d { position:fixed; top:0; left:0; right:0; bottom:86px; z-index:80; }
.editor-3d .voxel-world { background:linear-gradient(180deg,#0f3460 0%,#16213e 40%,#1a1a2e 100%); }

/* ── Undo/Redo Side Panel ── */
.side-panel { position:fixed; top:8px; left:8px; display:flex; flex-direction:column; gap:4px; z-index:97; }
.sp-btn { width:38px; height:38px; border:none; border-radius:8px; background:rgba(20,20,30,0.85); color:#fff; font-size:20px; cursor:pointer; display:flex; align-items:center; justify-content:center; border:1px solid rgba(255,255,255,0.1); }
.sp-btn:active { background:rgba(76,175,80,0.3); }
.sp-btn.disabled { opacity:0.3; pointer-events:none; }

/* ── Palette ── */
.palette-bar { position:fixed; left:0; right:0; bottom:46px; background:rgba(20,20,30,0.92); padding:4px 6px; display:flex; gap:3px; overflow-x:auto; z-index:95; border-top:1px solid rgba(255,255,255,0.05); }
.pal-swatch { width:28px; height:28px; border-radius:5px; border:2px solid transparent; cursor:pointer; flex-shrink:0; }
.pal-swatch.active { border-color:#fff; box-shadow:0 0 0 1px rgba(0,0,0,0.5); }

/* ── Role Selector ── */
.role-bar { position:fixed; left:0; right:0; bottom:82px; background:rgba(20,20,30,0.92); padding:4px 6px; display:none; gap:3px; overflow-x:auto; z-index:95; }
.role-bar.show { display:flex; }
.role-btn { height:26px; padding:0 8px; border:none; border-radius:5px; background:rgba(255,255,255,0.08); color:#ccc; font-size:10px; cursor:pointer; flex-shrink:0; text-transform:uppercase; }
.role-btn.active { background:rgba(76,175,80,0.3); color:#fff; }

/* ── Trigger Editor Panel ── */
.trigger-panel { position:fixed; inset:0; background:rgba(10,10,20,0.95); z-index:200; display:none; flex-direction:column; overflow-y:auto; padding:12px; }
.trigger-panel.show { display:flex; }
.trigger-panel h3 { font-size:16px; margin-bottom:10px; }
.trigger-card { background:rgba(255,255,255,0.06); border-radius:10px; padding:10px; margin-bottom:8px; }
.trigger-card label { font-size:11px; color:#888; text-transform:uppercase; display:block; margin-bottom:4px; }
.trigger-card select, .trigger-card input { width:100%; height:32px; border:1px solid rgba(255,255,255,0.1); border-radius:6px; background:rgba(0,0,0,0.3); color:#fff; padding:0 8px; font-size:13px; margin-bottom:6px; }
.btn-add-trigger { height:36px; border:1px dashed rgba(255,255,255,0.2); border-radius:8px; background:transparent; color:#888; width:100%; cursor:pointer; font-size:13px; }
.btn-close-panel { position:absolute; top:10px; right:10px; width:32px; height:32px; border:none; border-radius:50%; background:rgba(255,255,255,0.1); color:#fff; font-size:18px; cursor:pointer; }

/* ── Splash Screen ── */
.splash { position:fixed; inset:0; z-index:500; background:#0a0a18; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.splash-title { font-size:min(20vw, 100px); font-weight:900; letter-spacing:8px; color:#fff; text-shadow:0 0 40px rgba(76,175,80,0.4),0 0 80px rgba(76,175,80,0.2); }
.splash-sub { font-size:14px; color:#666; margin-top:8px; }
.splash-start { margin-top:40px; width:180px; height:54px; border:2px solid rgba(76,175,80,0.5); border-radius:12px; background:rgba(76,175,80,0.15); color:#4CAF50; font-size:20px; font-weight:700; cursor:pointer; letter-spacing:2px; transition:all 0.2s; }
.splash-start:active { background:rgba(76,175,80,0.35); transform:scale(0.96); }

/* ── Race HUD ── */
.race-hud { position:fixed; inset:0; pointer-events:none; z-index:300; }
.race-hud > * { pointer-events:auto; }
.race-pills { position:absolute; top:10px; left:50%; transform:translateX(-50%); font-size:22px; font-weight:700; text-shadow:0 1px 4px rgba(0,0,0,0.7); }
.race-pos { position:absolute; top:40px; left:50%; transform:translateX(-50%); font-size:14px; color:#aaa; }
.race-go { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:min(20vw, 80px); font-weight:900; color:#4CAF50; text-shadow:0 0 20px rgba(76,175,80,0.5); opacity:0; transition:opacity 0.3s; }
.race-go.show { opacity:1; }
.race-steer { position:absolute; bottom:10px; left:0; right:0; display:flex; justify-content:center; gap:8px; }
.race-steer button { width:70px; height:50px; border:none; border-radius:10px; background:rgba(255,255,255,0.1); color:#fff; font-size:24px; cursor:pointer; }
.race-steer button:active { background:rgba(255,255,255,0.25); }

/* ── Gyro toggle (race + editor) ── */
.gyro-btn { position:fixed; bottom:92px; right:20px; width:40px; height:40px; border:2px solid rgba(255,255,255,0.25); background:rgba(40,40,55,0.9); color:#fff; cursor:pointer; z-index:60; display:flex; align-items:center; justify-content:center; transition:border-radius 0.2s, background 0.2s; }
.gyro-btn.off { border-radius:6px; }
.gyro-btn.on { border-radius:50%; background:rgba(76,175,80,0.25); border-color:rgba(76,175,80,0.5); }
.gyro-btn:active { background:rgba(255,255,255,0.15); }
.gyro-icon { width:20px; height:20px; background:currentColor; opacity:0.9; }
.gyro-btn.off .gyro-icon { border-radius:2px; }
.gyro-btn.on .gyro-icon { border-radius:50%; }

/* ── White flash transition ── */
.flash { position:fixed; inset:0; z-index:400; background:#fff; opacity:0; transition:opacity 0.8s; pointer-events:none; }
.flash.on { opacity:1; }
